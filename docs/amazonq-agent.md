# Amazon Q Developer CLI エージェント開発ガイド

このプロジェクトでは、Amazon Q Developer CLIのプロジェクト専用エージェントを使用してコード修正を行うことができます。

## エージェントの起動

```bash
q chat --agent dev
```

プロジェクトルートで上記コマンドを実行すると、このプロジェクト用に設定されたAIエージェントが起動し、以下の機能を利用できます：

- **コード修正・改善**: 既存コードの品質向上やバグ修正
- **新機能追加**: AWSサービスの追加やUI機能の拡張
- **設定変更**: `app/shared/config.py`の設定項目追加・修正
- **ドキュメント更新**: 機能追加に伴うドキュメントの自動更新
- **テストコード生成**: 新機能に対応するテストケースの作成
- **レビュー**: コードやドキュメントの品質確認と改善提案
- **品質チェック**: pylint、pytest、セキュリティチェックの実行と修正
- **トラブルシューティング**: エラー解析と解決方法の提案

エージェントは`.amazonq/AmazonQ.md`に定義された開発標準とコード規約に従って作業を行います。

## 基本的な開発フロー

```bash
# 1. エージェント起動
q chat --agent dev

# 2. プロジェクト理解
このプロジェクトの概要を簡潔に教えて

# 3. 開発環境確認
開発環境のセットアップ方法を簡潔に教えて

# 4. 機能開発・修正
サポートサービスにECSを追加して

# 5. 品質チェック
just pylintを実行して
just pytestを実行して
just pysecurity-checkを実行して
```

## 実践的なプロンプト例

### プロジェクト理解

```bash
このプロジェクトの概要を簡潔に教えて
開発環境のセットアップ方法を簡潔に教えて
サポートしているAWSサービスを教えて
```

### 機能開発

```bash
# 新サービス追加
サポートサービスにECSを追加して

# 設定変更
必須タグにEnvironmentを追加して
デフォルトリージョンをap-northeast-1に変更して

# AWS機能実装時の検証
あなたの提案に問題ないかAWS公式ドキュメントで確認して
cfn/cfn-ecs.ymlに問題ないかAWS公式ドキュメントで確認して
```

### 品質管理

```bash
just pylintを実行して
just pytestを実行して
just pysecurity-checkを実行して
just pylintを実行して未使用のimport文や変数、関数を特定し、削除して
```

### ドキュメント更新

```bash
ECS追加に伴うドキュメントを更新して
```

### バージョン管理

```bash
# 変更をコミット
変更内容をコミットして

# 特定の変更のみコミット
ECS機能追加の変更のみコミットして

# 作業状況の確認
現在の変更状況を確認して、コミットが必要なファイルを教えて
```

### トラブルシューティング

```bash
AWS認証エラーが発生している。解決方法を教えて
just pylintでエラーが出ている。修正して
```

## 効果的なプロンプトの書き方

### 具体的で明確な指示

```bash
# 良い例
サポートサービスにECSを追加して、クラスター名、サービス名、タスク数を表示できるようにして

# 悪い例
ECSを追加して
```

### コンテキストの提供

```bash
# コンテキスト付きの指示
現在EC2、RDS、S3、Lambdaをサポートしているが、同様にECSも追加して
```

## エージェント使用上の注意事項

- 指示範囲を超えた広範囲修正のリスクがあるため、こまめにgitコミットする
- `fs_write`、`execute_bash`、`use_aws`はコードや環境を破損する可能性があるため、自動実行許可（trust）は避ける
- 一度に大きな範囲の修正は予期しない影響があるため避け、小さな修正を繰り返す
- 長時間作業時はコンテキストが混乱するため、定期的に`/clear`でリセットする
- AI修正後はデッドコードが残留するため、`just pylint`で未使用コードをチェックする
- CloudFormation提案は間違いが多いため、MCPを利用してAWS公式ドキュメントで検証する

## 参考情報

### エージェント設定ファイル

エージェントの動作は`.amazonq/AmazonQ.md`で定義されています。

### 関連ドキュメント

- [開発ドキュメント](development.md) - 開発環境セットアップ
- [設定ドキュメント](configuration.md) - 設定変更方法
- [アーキテクチャドキュメント](architecture.md) - システム構成
- [バッチ機能ドキュメント](batch.md) - バッチ処理の使用方法
