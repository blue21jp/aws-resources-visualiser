# AIエージェント向け指示書（AI専用版）

## 1. 最優先で遵守する指示（例外なし）

1. 回答は**必ず日本語**で生成する。
2. 指示内容とコードを**完全に理解してから回答**する。
3. 回答は**簡潔に**する。サンプルコードは書かない。
4. 指示を実行した場合にセキュリティ上のリスクが想定される場合は**ユーザにリスクを指摘し、確認を取得してから進める**。
5. **MCPを必ず使用**し、AWSサービス情報は最新ドキュメントに基づき回答する。

## 2. ロケール・通貨

* タイムゾーン：`Asia/Tokyo`
* 金額表記：JPY併記（1USD = 150JPY固定）
  ※最新レート取得は行わない

## 3. 開発標準

### ドキュメント

* コマンドは **README, justfile** に記載
* 詳細情報は **docsディレクトリのMarkdown形式** に格納
* コード修正後は、必ず、ドキュメントを最新化すること

### AWSリソース開発

* **CloudFormation** を使用

* 必須ツール：
  * aws-cli(v2)
  * rain
  * cfn-lint
  * just

### Python開発

* **poetry仮想環境** を使用

* 必須ツール：
  * mise（Python/Poetryバージョン管理）
  * poetry
  * just

* pyproject.toml管理対象：

  * モジュール依存関係
  * flake8, black, isort, mypy設定

### コード規約

* 全般：
  * 言語のベストプラクティス遵守
  * クリーンコード原則・DRY原則のバランス重視（読みやすさ優先）
  * コメントは「なぜ行うか」を簡潔に日本語で記載

* Python：
  * 関数の引数と戻り値には**型を必ず付与**

* CloudFormation：
  * YAML形式のみ
  * スタック間依存禁止（ネスト・OutputsのExport使用禁止）
  * Lambda用CloudWatchLogsは必ず定義
  * 複数アカウント対応：Mappings・組み込み変数使用
  * 組み込み関数は短縮記法使用
  * if文使用禁止

### テスト規約

* コード修正後は、必ず、テストコードを最新化すること
* Python：
  * pytest使用
  * Class構造化、conftest.pyで共通処理管理
  * fixtures, parametrize活用

### 品質管理

* CloudFormation：cfn-lint
* Python：flake8, black, isort, mypy, vulture

### プロジェクト固有技術スタック

* **既存パターンの維持**：新機能追加時も既存の技術スタックに沿って実装すること
* **MCP Serverの一般的なガイダンス**は参考程度に留めること
* **外部情報との区別**：MCP Serverから取得した一般的なAWS開発パターンと、このプロジェクト固有の要件を明確に区別すること

### Gitコミットルール

* 日本語で書くこと
* 概要行のみ、50文字以内、現在形・命令形、1コミット1目的
* コミット内容を確認し、セキュリティリスクを検知した場合は、ユーザに警告すること

## 4. コード修正判断基準

* **既存パターンを踏襲**
* 後方互換は考慮せず、クリーンなコード重視
* 将来拡張は考慮せず、クリーンなコード重視
* コメントアウトせず、クリーンなコード重視
* **必ずコード分析**する
* 修正前に**コメントで修正案と影響範囲を提示**し、ユーザ確認後に実行

### 機能追加

* 既存類似機能を参考にする
* 新AWSサービスは既存サービスの実装を模倣
* ページネーション必須

### 設定変更

* 新設定は config.py 既存パターンに従う
* デフォルト値必須

### UI改善

* **指示がある場合のみ変更可能**とし、不明な場合は事前確認すること
* 文言・レイアウト・カラー変更禁止
* Streamlit既存UI要素との整合性必須
* エラーメッセージは既存パターン準拠

## 5. 技術的制約

### 必須

* エラーハンドリング
* AWS IAM最小権限

### 絶対禁止

* 設定値ハードコード
* 認証情報埋め込み
* requirements.txt直接編集
* 指示のないUI改善
* 指示のないgitコマンド操作
* 指示のないAWS環境変更

## 6. 判断優先順位

1. セキュリティ > パフォーマンス > 機能性
2. 既存パターン踏襲 > 新実装方式
